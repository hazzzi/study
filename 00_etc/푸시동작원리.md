# 푸시 서버 동작 원리

1. 앱 실행
2. 구글로 부터 푸시 토큰을 발급받아옴 (google: GCM(old), FCM(new) | apple: APNS)
3. 해당 푸시토큰을 앱 서버로 전송

## web-admin
- 푸시 건수는 몇건인지
- 실패한 푸시 정보, 건수

## Server
- 푸시토큰 + deviceId 저장
- 푸시 발송은 백그라운드 잡에서 실행된다.
  - 푸시 스케쥴링 테이블에서 발송 예정인 푸시메세지를 조회해서 보냄
  - 5초간격으로 DB에서 읽어와서 보낸다.
  - 보안을 위해서 인증서를 발급받아서 통신(토큰을 발급 받아와서 통신)
- 구글 클라우드 메세징 서버와 앱서버와 네트워크의 장애가 있을땐?
  - 푸시 재시도 로직이 필요함 (2^n초 형태로 시도한다, 2초, 4초,....)

## DB
푸시 테이블
- 푸시를 발송한 시각 / 시간 정보
- 푸시 타입 ( 메세지, 메세지 + 아이콘, ...)
- 푸시 메세지
- 사용자 ID
- 성공 / 실패 여부
- 기타 정보

푸시 토큰 테이블
- 디바이스 아이디
- 사용자 아이디
- 푸시 토큰